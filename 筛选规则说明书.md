# 数据筛选工具 - 详细规则说明书

**版本日期**：2025-12-09
**适用程序**：Excel Data Filter Tool (Windows版)

本文档详细描述了程序内部的数据处理逻辑与筛选规则，供维护与核对使用。

---

## 1. 数据预处理与清洗 (Data Preprocessing)

在执行任何筛选规则之前，程序会先对原始数据进行统一清洗，以确保数据的一致性。

### 1.1 工号标准化
*   **处理对象**：所有表格（工时数据、基本数据、过岗数据、花名册）中的“工号”列。
*   **处理逻辑**：强制转换为**纯文本格式**，并去除首尾空格。
*   **目的**：解决 Excel 中数字格式（如 `1001`）与文本格式（如 `'1001'`）不一致导致的匹配失败问题。

### 1.2 日期格式化
*   **处理对象**：涉及日期的所有关键列（入职日期、转正日期、离职日期、证书生效日期、开业/闭店时间、奖金月份）。
*   **处理逻辑**：
    *   自动识别标准格式 `YYYY-MM-DD`。
    *   自动识别中文格式 `YYYY年MM月DD日`。
    *   统一转换为程序内部的时间对象进行比较。

### 1.3 工时汇总
*   **处理对象**：工时数据表。
*   **处理逻辑**：
    *   按**工号**对该员工在**所有门店**的记录进行汇总。
    *   **累计总工时** = 该员工所有记录的“总工时”之和。
    *   **累计月工时** = 该员工所有记录的“考勤工时”之和。
*   **应用**：后续筛选规则（如兼职规则）中使用的“工时”均为这个汇总后的数值。

---

## 2. 核心逻辑：职位标准化 (Job Title Standardization)

**这是筛选前最重要的步骤。** 程序会**修改**“工时数据”中的职位名称，以确保数据的准确性。

1.  **第一优先级（基本数据）**：
    *   首先根据工号在“基本数据”表中查找。
    *   如果找到且职位不为空，**强制将工时数据中的职位名称替换为**基本数据中的职位。
2.  **第二优先级（花名册）**：
    *   如果基本数据未找到，则在“花名册”表中查找。
    *   如果找到且职位不为空，**将工时数据中的职位名称替换为**花名册中的职位。
3.  **兜底（原数据）**：
    *   只有上述两者都无效时，才保留“工时数据”原本的职位名称。

> **效果示例**：例如员工A在“工时数据”里有3条记录，职位分别显示为“茶饮师”、“Pro训练员”、“调茶大咖”。只要他在“基本数据”中的职位是“茶饮师”，程序会将他在“工时数据”里的这3条记录的职位名称**全部替换**为“茶饮师”，并后续统一按“茶饮师”的规则进行判断。

---

## 3. 奖金资格筛选规则 (Filter Rules)

**奖金月份设定**：默认为 `2025年11月`（或读取“筛选条件”表中的设定）。
以下所有“时间要求”均以奖金月份的 **1号** 为截止点。

### ✅ 规则一：茶饮师类
*   **适用职位**：
    *   `茶饮师`
    *   `茶饮师（S）`
    *   `Pro训练员`
    *   `茶饮训练员`
*   **筛选条件**（必须同时满足）：
    1.  **证书齐全**：必须集齐以下 3 个证书：
        *   【奈雪】大堂服务岗证书
        *   【奈雪】后厨岗证书
        *   【奈雪】水吧岗证书
    2.  **时间合规**：取这 3 个证书中**最晚**拿到的那个日期，必须**早于**奖金月份的1号。

### ✅ 规则二：兼职与实习生
*   **适用职位**：
    *   职位名称包含“兼职”的职位
    *   `就业见习生`
*   **筛选条件**（必须同时满足）：
    1.  **累计总工时** ≥ 40 小时。
    2.  **当月考勤工时** ≥ 50 小时。
    3.  **持有证书**：上述 3 个证书中持有**任意 1 个**即可。
    4.  **时间合规**：该证书的生效日期必须**早于**奖金月份的1号。

### ✅ 规则三：副经理/副店长
*   **适用职位**：
    *   `副经理`
    *   `副店长`
*   **筛选条件**：
    *   **入职满30天**：(入职日期 + 29天) 必须**早于**奖金月份的1号。

### ✅ 规则四：店长类
*   **适用职位**：
    *   `店长`
    *   `店长（S）`
    *   `见习店长`
    *   `资深店长`
*   **筛选条件**：
    *   **自动通过**：凡是此类职位，直接纳入奖金名单。
    *   **附加标记**：结果表中会增加“是否门店负责人”列，根据“门店负责人”表标记为“是”或“否”。

---

## 4. 输出结果说明 (Output)

程序运行结束后，会在同目录下生成两个 Excel 文件：

1.  **`筛选结果.xlsx`**
    *   **内容**：所有符合上述筛选规则的员工名单。
    *   **字段补全**：身份证、第三方、工作地区等信息优先从基本数据获取，缺失则从花名册补全。

2.  **`筛选排除原因.xlsx`**
    *   **内容**：所有被程序剔除的员工名单。
    *   **关键列**：`排除原因`（中文描述）。
    *   **用途**：用于核对员工为何未入选（如：“茶饮师：缺少必要的证书”、“累计工时(30)<40”等）。
